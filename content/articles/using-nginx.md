+++
title = "Понимание веб-разработки: работа с nginx"
date = "2025-10-28"
description = "Изучаем основы работы с nginx в качестве локального сервера."
draft = true

[taxonomies]
tags=["инструменты", "навыки"]
+++

==============================================================================
ВЫ НАШЛИ ПАСХАЛКУ, ПОЗДРАВЛЯЮ! ЭТО НЕОПУБЛИКОВАННАЯ СТАТЬЯ, ЕЕ МОГ УВИДЕТЬ ТОЛЬКО ДЕЙСТВИТЕЛЬНО ЛЮБОПЫТНЫЙ ЧЕЛОВЕК.
==============================================================================

Это заключительная статья из серии, посвящённой пониманию веб-разработки. В серии три статьи, в которых разбирается следующее:

1. [Устройство клиент-серверного взаимодействия](@/articles/http-api-quickstart.md);
1. [Изучение того, как браузер получает и отображает данные](@/articles/using-devtools.md);
1. → Развернём собственный локальный сервер, чтобы почувствовать, как работает веб изнутри.

Цель этой статьи — помочь разобраться, как работать с веб-сервером, используя простой и понятный инструмент [nginx](https://nginx.org).

## Что такое веб-сервер

Веб-сервер — это программа, которая принимает запросы от браузера или другого клиента и отвечает на них. Основная задача — доставить файлы: HTML, CSS, JSON и т.д.

Существует два основных типа серверов:

| Статический | Динамический |
| --- | --- |
| Отдаёт файлы «как есть». Никакой обработки, никакого кода. Подходит для сайтов, документации, интерфейсов одностраничных приложений (SPA). | Обрабатывает данные, взаимодействует с базой данных, может создавать или изменять ресурсы, что дает возможность работать с API. Такие серверы используют Node.js, Python, Java и другие языки. |

В этой статье мы работаем со статическим сервером. Он не меняет данные, но показывает, как контент становится доступен через HTTP.

## Установка nginx

Я готовил примеры для этой статьи на Mac. Примеры для Windows не проверялись, но это полностью аналогичные действия с поправкой на особенности работы с файловой системой Windows через Git Bash.

### macOS

1. Если у вас установлен Homebrew, выполните:

  ```bash
  brew install nginx
  ```

  Конфигурация находится в `/usr/local/etc/nginx/nginx.conf`.
  Файлы сайта — в `/usr/local/share/nginx/html`.

1. Перейдите в директорию с сайтами: `/usr/local/share/nginx/html`.

1. Замените или создайте файл `index.html`:

  ```html
  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="UTF-8">
      <title>Локальный сервер</title>
    </head>
    <body>
      <h1>Сервер работает!</h1>
      <p>Это страница отдана через nginx.</p>
    </body>
  </html>
  ```

### Windows (с Git Bash)

1. Скачайте с [сайта поставщика](https://nginx.org/download/) архив `nginx-1.<последняя_версия>.0.zip`

1. Распакуйте архив. В этой статье для удобства распакованные файлы помещены по адресу `C:\nginx`

  Конфигурация: `C:\nginx\conf\nginx.conf`.
  Файлы сайта: `C:\nginx\html`.

В Git Bash используйте пути в стиле Unix: cd /c/nginx вместо C:\nginx

1. Перейдите в папку с сайтами: `C:\nginx\html`.

1. Замените или создайте файл `index.html`:

  ```html
  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="UTF-8">
      <title>Локальный сервер</title>
    </head>
    <body>
      <h1>Сервер работает!</h1>
      <p>Это страница отдана через nginx.</p>
    </body>
  </html>
  ```

## Запуск сервера

### Навигация по файловой системе в терминале

Чтобы уверенно работать с сервером, нужно уметь перемещаться по папкам.

Команды:

- `pwd` — покажет, где вы сейчас находитесь (полный путь)
- `ls` — покажет содержимое текущей папки
- `cd имя_папки` — войти в папку
- `cd ..` — подняться на уровень выше
- `cd ~` — вернуться в домашнюю директорию.

Пример:
Вы в `/home/user/web`
Хотите перейти в `/home/user/web/docs`
Введите: `cd docs`

Хотите вернуться обратно?
Введите: `cd ..`

### Работа с двумя вкладками терминала

Рекомендуется открыть две вкладки терминала:

- В одной — управлять nginx (запуск, остановка, перезагрузка)
- В другой — выполнять curl, проверять данные, работать с файлами

### Запуск на macOS

Введите команду:

```bash
nginx
```

Или для автоматического запуска при старте системы:

```bash
brew services start nginx
```

Если возникает ошибка доступа, попробуйте:

```bash
sudo nginx
```

### Запуск на Windows (через Git Bash)

```bash
cd /c/nginx
start nginx
```

или

```bash
./nginx.exe
```

## Проверка работы

Откройте браузер и перейдите по адресу:

```
http://localhost
```

Вы должны увидеть вашу страницу.

### Что такое localhost?

`localhost` — это имя, которое всегда указывает на ваш собственный компьютер. Оно связано с IP-адресом 127.0.0.1.

Когда вы заходите на `http://localhost`, браузер обращается к программе, работающей у вас на машине.

Это отличается от удалённого сервера, например `example.com`, который работает на другом компьютере и доступен по внешнему IP.

### Проверка через curl

`curl` — универсальный инструмент для отправки HTTP-запросов.

Чтобы проверить заголовки ответа, выполните:

```bash
curl -I http://localhost
```

Вы увидите:

```
HTTP/1.1 200 OK
Server: nginx/...
Content-Type: text/html
...
```

Если вы изменили порт:

```bash
curl -I http://localhost:8080
```

## Остановка сервера

Чтобы остановить nginx, выполните:

```bash
nginx -s stop
```

На всех системах команда одинакова. На Windows в Git Bash:

```bash
cd /c/nginx
nginx -s stop
```

## Логи: где смотреть ошибки

Nginx записывает все действия в логи.

Основные файлы:

- `access.log` — успешные запросы
- `error.log` — ошибки

Расположение:

- macOS: `/usr/local/var/log/nginx/access.log`
- Windows: `C:\nginx\logs\access.log`

Пример записи:

```
127.0.0.1 - - [05/Apr/2025:12:34:56 +0000] "GET / HTTP/1.1" 200 612
```

Это значит, что кто-то с IP 127.0.0.1 запросил главную страницу, получил статус 200 и 612 байт данных.

### Что дальше

#### Запустите сервер на другом порту

### Порты: что это и зачем они нужны?

Порт — это логическая сущность, через которую сервер принимает запросы.

По умолчанию:

- HTTP использует порт 80
- HTTPS — порт 443

Nginx настроен на порт 80. Если он занят, можно изменить номер порта в файле `nginx.conf`:

```nginx
listen 8080;
```

После этого в браузере:

```text
http://localhost:8080
```

Порты позволяют запускать несколько серверов одновременно. Например, один на 80, другой на 3000.

#### Проверьте работу с мобильного устройства

Узнайте IP вашего компьютера в сети (`ifconfig` или `ipconfig`), откройте `http://ваш.айпи:8080` с телефона. Убедитесь, что сервер доступен.

#### Настройте кастомную 404-страницу

Когда пользователь переходит по несуществующему адресу, сервер возвращает ошибку 404 Not Found. По умолчанию nginx показывает стандартное сообщение, но его можно заменить на собственную страницу — это полезно для документации, демонстраций и локальных сайтов.

1. Создайте страницу 404

  В папке с контентом (например, `/usr/local/share/nginx/html` или `C:\nginx\html`) создайте файл `404.html`:
  
  ```html
  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="UTF-8">
    <title>Страница не найдена</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 50px;
      }
      h1 { color: #d32f2f; }
      a { color: #1976d2; }
    </style>
  </head>
  <body>
    <h1>404 — Страница не найдена</h1>
    <p>Запрашиваемая страница не существует.</p>
    <p><a href="/">Вернуться на главную</a></p>
  </body>
  </html>
  Сохраните файл рядом с index.html.
  ```

1. Настройте nginx

  Откройте файл `nginx.conf` и найдите блок `server`.

  Добавьте внутри:

  ```ini
  error_page 404 /404.html;

  location = /404.html {
      internal;
  }
  ```

  - `error_page 404 /404.html` — говорит nginx показывать этот файл при ошибках 404
  - `location = /404.html` с флагом `internal` — запрещает прямой доступ к странице извне, чтобы её нельзя было открыть напрямую без ошибки

1. Перезагрузите сервер
  
  Выполните в терминале:

  ```bash
  nginx -s reload
  ```

1. Откройте в браузере любой несуществующий адрес:

  ```text
  http://localhost/missing-page
  ```

  Вместо стандартного сообщения вы увидите вашу красивую страницу 404.

  Также можно проверить через curl:

  curl -I http://localhost/xyz

  Вы увидите:

  `HTTP/1.1 404 Not Found`
